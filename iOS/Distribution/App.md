# App Distribution

## 1. Why Code Signing?

Code signing process ensures `security` & `integrity` of the app.
The process establishes trust between:-
- The App
- The Device
- The Developer

*Signing app allows iOS to identify who signed the app and to verify that the app hasn’t been modified since it was signed*

Once iOS or iPadOS kernel has started, the kernel will control which all processes and apps are allowed to run.
One of the kernel’s key security checks is to ensure that:
    - Apps originate from a known and trusted source.
    - The code has not been tampered with.
Therefore, on iPadOS and iOS it is required that all executable code is signed using an Apple issued certificate.


## 2. iOS App Code Signing

### 2.1 Signing Certificate
- A certificate guarantees that one knows Apple and Apple knows the developer.
- There is a mutual recognition.
- Another way to look at it is that the developer of app needs to identify himself/herself to Apple.
- This is done by creating a certificate and asking Apple to sign it.
- For this purpose one creates a Certificate Signing Request.
- Once one gets certificate and adds to keychain, any build signed by Xcode uses this certificate which guarantees the
code is coming from authorised person or team.

There are two flavours of signing certificate
- 1. Development Certificate
    - This one need in order to build code and install on a device using Xcode.
    - A development certificate identifies one as a developer and contains the developer identifier.
    - Even when one signs up as an apple developer as an individual, one still have both a developer and team identifier.
- 2. Distribution Certificate
    - Required to distribute app to Testflight or to App store.
    - Belong to the team
    - A distribution certificate contains one’s team identifier and identifies a team.

The signing certificate is a public private pair with

- Private key
    - Resides in keychain of build machine(For e.g. the MacBook or iMac)
- Public
    - User ID
    - Team ID
    - Public key


### How to create a signing certificate?
- Create a Certificate Signing Request using the keychain Access app from Mac
- This creates the public and private keys that will identify one’s certificate

### Provisioning Profiles
A provisional profile may contain:
1. Distribution type
2. Signing Certificate
3. Team/Developer ID
4. Entitlements
5. Destination Devices (UUIDs)
6. Expiration date

Following are types of provisioning profiles :
1. Development Provisioning Profile
    - This profile contains device's UUIDs for all devices which are expected to install app
    - Include's developer's certificate
2. Distribution Provisioning Profile
    - Ad-hoc provisioning profile
        - Generally used to distribut app to Testflight testers
        - This profile contains device's UUIDs for all devices which are expected to install app
        - Includes distribution certificate
    - Enterprise provisioning profile : TODO Not sure if this is relevant
        - Includes distribution certificate
        - Business and organisations requiring enterprise distribution need to apply to Apple Developer Enterprise Programme (ADEP).
    - App store provisioning profile
        - No UUIDs are required here
        - Includes distribution certificate

### How to create a development provisioning profile?
- Sign in with developer account on http://developer.apple.com
- Go to Certificate, Identifier and Profiles
- Under profiles there should be a + button to add a new profile.
- Tap + and under Development select appropriate type of profile needed.
- Select the App ID needed for development
- Select all development certificates which are needed
- Select devices which are required
- Enter a profile name, and generate then download

### App ID vs Bundle ID vs Team ID
- App ID
    - App ID is combination of Team ID and Bundle ID
- Bundle ID
    - Uniquely identifies an application in Apple's ecosystem
    - Apple encourages to use reverse domain name notation
- Team ID
    - Generated by Apple for a development team
    - A team identifier is a 10-character alphanumeric string

```
App ID = Team ID . Bundle ID

For e.g.
ABCDE12345.com.apple.saurabh.SomeAppProject
Here ABCDE12345 is Team ID
com.apple.saurabh.SomeAppProject is reverse domain Bundle ID
Combined, ABCDE12345.com.apple.saurabh.SomeAppProject is the App ID
```


## How does the verification works in code signing an app?
Code signing verification ensures that an app hasn’t been tampered with and is from a trusted developer. This is done
using cryptographic hashes and digital signatures.

**Here’s how it works**

### 1. Hashing the Code
- When an app is signed, a unique cryptographic hash (a digital fingerprint) of its code is generated. 

### 2. Creating the Signature
- Generated hash is then encrypted with the developer’s private key. The result is called a digital signature.
    - Private key can be thought of as a wax seal which only the developer has and can use.

### 3. Storing the Signature
- The app bundle contains both the original code and the signature.

### 4. Verification on the Device
- When the app is run on an iPhone or iPad, the device performs these checks
    - It uses the developer’s public key (from an Apple-issued certificate) to decrypt the digital signature, getting the original hash.
    - It then generates a fresh hash from the app’s current code on the device.
    - If the two hashes match, it confirms that
        - The code has not been modified.
        - The app is from a trusted developer.


## Notes
- Images, nib files are not signed, so changes to these doesn't invalidates the signature.

## TODOs
- [x] Move size classes to proper place.


https://www.bounteous.com/insights/2018/08/08/demystifying-ios-app-provisioning-process
